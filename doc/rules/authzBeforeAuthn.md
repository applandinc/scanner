## Description

Determines when authorization logic is applied to a user identity that has not been properly
verified. Because the the user's identity has not been verified yet, the outcome of the
authorization check cannot be trusted. A malicious user might be able to get themselves authorized
as a different user than they really are - or they may not be logged in at all.

## Rule logic

Operation of this rule depends on two label: `secret` and `log`. A function labeled `secret` is
assumed to return a secret value - this rule keeps a running tally of all the secrets created in an
AppMap. When a function labeled `log` is called, the rule looks at the log message, and checks
whether any of the known secrets are in it.

The log message is also tested against a list of known regular expressions that are likely to match
secrets.

## Notes

Be sure and apply the `secret` label to any function in your code base that generates a secret. For
example: encryption keys, user tokens, API keys, reset tokens, etc.

## Resolution

If the log message is written by code that you control, the simplest resolution is to remove the log
statement - or to remove the secret from the log message.

If the log message is not controlled by you (it's generated by a framework), your choices are more
limited. You could open a pull request with the framework, or you can increase the log level to
suppress the offending message.

## Options

None

## Examples

```yaml
- rule: authzBeforeAuthn
```
